alter session set "_oracle_script"=true;
create user empleado identified by empleado;
GRANT CONNECT, RESOURCE, DBA TO empleado

CREATE TABLE DEPARTAMENTO(
	CODIGO NUMBER(10),
	NOMBRE VARCHAR2(100),
	PRESUPUESTO BINARY_DOUBLE,
	CONSTRAINT PK_CODIGO PRIMARY KEY (CODIGO)
);
CREATE TABLE EMPLEADO(
	CODIGO NUMBER(10),
	NIF VARCHAR2(9),
	NOMBRE VARCHAR2(100),
	APELLIDO1 VARCHAR2(100),
	APELLIDO2 VARCHAR2(100),
	CODIGO_DEPARTAMENTO NUMBER(10),
	CONSTRAINT PK_CODIGO_EMPLEADO PRIMARY KEY (CODIGO),
	CONSTRAINT FK_EMPLEADO FOREIGN KEY (CODIGO_DEPARTAMENTO) REFERENCES DEPARTAMENTO(CODIGO)
);
ALTER TABLE DEPARTAMENTO ADD GASTOS BINARY_DOUBLE;
--Insertamos los datos.
--Tabla DEPARTAMENTO
INSERT INTO DEPARTAMENTO (CODIGO,NOMBRE,PRESUPUESTO,GASTOS)
VALUES (1,'Desarrollo',120000,6000);
INSERT INTO DEPARTAMENTO (CODIGO,NOMBRE,PRESUPUESTO,GASTOS)
VALUES (2,'Sistemas',150000,21000);
INSERT INTO DEPARTAMENTO (CODIGO,NOMBRE,PRESUPUESTO,GASTOS)
VALUES (3,'Recursos Humanos',280000,25000);
INSERT INTO DEPARTAMENTO (CODIGO,NOMBRE,PRESUPUESTO,GASTOS)
VALUES (4,'Contabilidad',110000,3000);
INSERT INTO DEPARTAMENTO (CODIGO,NOMBRE,PRESUPUESTO,GASTOS)
VALUES (5,'I+D',375000,380000);
INSERT INTO DEPARTAMENTO (CODIGO,NOMBRE,PRESUPUESTO,GASTOS)
VALUES (6,'Proyectos',0,0);
INSERT INTO DEPARTAMENTO (CODIGO,NOMBRE,PRESUPUESTO,GASTOS)
VALUES (7,'Publicidad',0,1000);

--Tabla EMPLEADO
INSERT INTO EMPLEADO (CODIGO,NIF,NOMBRE,APELLIDO1,APELLIDO2,CODIGO_DEPARTAMENTO)
VALUES (1,'32481596F','Aarón','Rivero','Gómez',1);
INSERT INTO EMPLEADO (CODIGO,NIF,NOMBRE,APELLIDO1,APELLIDO2,CODIGO_DEPARTAMENTO)
VALUES (2,'Y5575632D','Adela','Salas','Díaz',2);
INSERT INTO EMPLEADO (CODIGO,NIF,NOMBRE,APELLIDO1,APELLIDO2,CODIGO_DEPARTAMENTO)
VALUES (3,'R6970642B','Adolfo','Rubio','Flores',3);
INSERT INTO EMPLEADO (CODIGO,NIF,NOMBRE,APELLIDO1,APELLIDO2,CODIGO_DEPARTAMENTO)
VALUES (4,'77705545E','Adrián','Suárez',NULL,4);
INSERT INTO EMPLEADO (CODIGO,NIF,NOMBRE,APELLIDO1,APELLIDO2,CODIGO_DEPARTAMENTO)
VALUES (5,'17087203C','Marcos','Loyola','Méndez',5);
INSERT INTO EMPLEADO (CODIGO,NIF,NOMBRE,APELLIDO1,APELLIDO2,CODIGO_DEPARTAMENTO)
VALUES (6,'38382980M','María','Santana','Moreno',1);
INSERT INTO EMPLEADO (CODIGO,NIF,NOMBRE,APELLIDO1,APELLIDO2,CODIGO_DEPARTAMENTO)
VALUES (7,'80576669X','Pilar','Ruiz',NULL,2);
INSERT INTO EMPLEADO (CODIGO,NIF,NOMBRE,APELLIDO1,APELLIDO2,CODIGO_DEPARTAMENTO)
VALUES (8,'71651431Z','Pepe','Ruiz','Santana',3);
INSERT INTO EMPLEADO (CODIGO,NIF,NOMBRE,APELLIDO1,APELLIDO2,CODIGO_DEPARTAMENTO)
VALUES (9,'56399183D','Juan','Gómez','López',2);
INSERT INTO EMPLEADO (CODIGO,NIF,NOMBRE,APELLIDO1,APELLIDO2,CODIGO_DEPARTAMENTO)
VALUES (10,'46384486H','Diego','Flores','Salas',5);
INSERT INTO EMPLEADO (CODIGO,NIF,NOMBRE,APELLIDO1,APELLIDO2,CODIGO_DEPARTAMENTO)
VALUES (11,'67389283A','Marta','Herrera','Gil',1);
INSERT INTO EMPLEADO (CODIGO,NIF,NOMBRE,APELLIDO1,APELLIDO2,CODIGO_DEPARTAMENTO)
VALUES (12,'41234836R','Irene','Salas','Flores',NULL);
INSERT INTO EMPLEADO (CODIGO,NIF,NOMBRE,APELLIDO1,APELLIDO2,CODIGO_DEPARTAMENTO)
VALUES (13,'82635162B','Juan Antonio','Sáez','Guerrero',NULL);


--1. Inserta un nuevo departamento indicando su código, nombre y presupuesto.
INSERT INTO DEPARTAMENTO (CODIGO,NOMBRE,PRESUPUESTO)
VALUES (8,'STOCK',150000);

--2. Inserta un nuevo departamento indicando su nombre y presupuesto.(DA ERROR DEBIDO A QUE EL CODIGO ES NO NULO)
INSERT INTO DEPARTAMENTO (NOMBRE,PRESUPUESTO)
VALUES ('STOCK',150000);

--3. Inserta un nuevo departamento indicando su código, nombre, presupuesto y gastos.
INSERT INTO DEPARTAMENTO (CODIGO,NOMBRE,PRESUPUESTO,GASTOS)
VALUES (9,'JEFATURA',100000,1200);

--4. Inserta un nuevo empleado asociado a uno de los nuevos departamentos. La sentencia de inserción debe incluir: código, nif, nombre, apellido1, apellido2 y codigo_departamento.
INSERT INTO EMPLEADO (CODIGO,NIF,NOMBRE,APELLIDO1,APELLIDO2,CODIGO_DEPARTAMENTO)
VALUES (14,'82635345W','Juan Antonio','Sáez','Guerrero',NULL);

--5. Inserta un nuevo empleado asociado a uno de los nuevos departamentos. La sentencia de inserción debe incluir: nif, nombre, apellido1, apellido2 y codigo_departamento.
--(DA ERROR DEBIDO A QUE EL CODIGO ES NO NULO)
INSERT INTO EMPLEADO (NIF,NOMBRE,APELLIDO1,APELLIDO2,CODIGO_DEPARTAMENTO)
VALUES ('82637345W','Juan Antonio','Sáez','Sáez',NULL);

--6. Crea una nueva tabla con el nombre departamento_backup que tenga las mismas columnas que la tabla departamento. Una vez creada copia todos las filas de tabla departamento en departamento_backup.
CREATE TABLE DEPARTAMENTO_BACKUP(
	CODIGO NUMBER(10),
	NOMBRE VARCHAR2(100),
	PRESUPUESTO BINARY_DOUBLE,
	GASTOS BINARY_DOUBLE,
	CONSTRAINT PK_CODIGO_BACKUP PRIMARY KEY (CODIGO)
);
INSERT INTO DEPARTAMENTO_BACKUP (CODIGO,NOMBRE,PRESUPUESTO,GASTOS)
VALUES (1,'Desarrollo',120000,6000);
INSERT INTO DEPARTAMENTO_BACKUP (CODIGO,NOMBRE,PRESUPUESTO,GASTOS)
VALUES (2,'Sistemas',150000,21000);
INSERT INTO DEPARTAMENTO_BACKUP (CODIGO,NOMBRE,PRESUPUESTO,GASTOS)
VALUES (3,'Recursos Humanos',280000,25000);
INSERT INTO DEPARTAMENTO_BACKUP (CODIGO,NOMBRE,PRESUPUESTO,GASTOS)
VALUES (4,'Contabilidad',110000,3000);
INSERT INTO DEPARTAMENTO_BACKUP (CODIGO,NOMBRE,PRESUPUESTO,GASTOS)
VALUES (5,'I+D',375000,380000);
INSERT INTO DEPARTAMENTO_BACKUP (CODIGO,NOMBRE,PRESUPUESTO,GASTOS)
VALUES (6,'Proyectos',0,0);
INSERT INTO DEPARTAMENTO_BACKUP (CODIGO,NOMBRE,PRESUPUESTO,GASTOS)
VALUES (7,'Publicidad',0,1000);
INSERT INTO DEPARTAMENTO_BACKUP (CODIGO,NOMBRE,PRESUPUESTO)
VALUES (8,'STOCK',150000);
INSERT INTO DEPARTAMENTO_BACKUP (CODIGO,NOMBRE,PRESUPUESTO,GASTOS)
VALUES (9,'JEFATURA',100000,1200);

--7. Elimina el departamento Proyectos. ¿Es posible eliminarlo? Si no fuese posible, ¿qué cambios debería realizar para que fuese posible borrarlo?
DELETE FROM DEPARTAMENTO
WHERE NOMBRE='Proyectos';

--8. Elimina el departamento Desarrollo. ¿Es posible eliminarlo? Si no fuese posible, ¿qué cambios debería realizar para que fuese posible borrarlo?
DELETE FROM DEPARTAMENTO
WHERE NOMBRE='Desarrollo';
--(DA ERROR POR LA FK)SQL Error [2292] [23000]: ORA-02292: restricción de integridad (EMPLEADO.FK_EMPLEADO) violada - registro secundario encontrado

--9. Actualiza el código del departamento Recursos Humanos y asígnale el valor 30. ¿Es posible actualizarlo? Si no fuese posible, ¿qué cambios debería realizar para que fuese actualizarlo?
UPDATE DEPARTEMENTO
SET CODIGO=30
WHERE NOMBRE='Recursos Humanos'
--DA ERROR

--10.Actualiza el código del departamento Publicidad y asígnale el valor 40. ¿Es posible actualizarlo? Si no fuese posible, ¿qué cambios debería realizar para que fuese actualizarlo?
UPDATE DEPARTEMENTO
SET CODIGO=40
WHERE NOMBRE='Publicidad'
--DA ERROR

--11.Actualiza el presupuesto de los departamentos sumándole 50000 € al valor del presupuesto actual, solamente a aquellos departamentos que tienen un presupuesto menor que 20000 €.
UPDATE DEPARTAMENTO
SET PRESUPUESTO=PRESUPUESTO+50000
WHERE PRESUPUESTO<20000;

--12.Realiza una transacción que elimine todas los empleados que no tienen un departamento asociado.
DELETE FROM EMPLEADO
WHERE CODIGO_DEPARTAMENTO=NULL
